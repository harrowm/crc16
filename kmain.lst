Sections:
00: ".text" (0-432)
01: ".data" (0-400)


Source: "kmain.asm"
                            	     1: ; Test the CRC16 Algorithm in 68000 assembler
                            	     2: ; To run this you need the precalculated table in ../target
                            	     3: ; Malcolm Harrow August 2023
                            	     4: 
                            	     5:     section .text                     
                            	     6: 
                            	     7: kmain::
                            	     8:     ; this code will eventually go into the SD Card read/write routines
                            	     9:     ; so we dont want to trash any registers that aren't trashed by 
                            	    10:     ; the current version of the code or unforseen things could happen
                            	    11:     ; to existing software
                            	    12: 
                            	    13:     ; C code we try to replicate ..
                            	    14:     ; uint16_t UpdateCRC(uint16_t* table, uint8_t byte, uint16_t prevCRC) {   
                            	    15:     ;     return table[((prevCRC >> 8) ^ byte) & 0xff] ^ (prevCRC << 8);
                            	    16:     ; }
                            	    17:     ; uint16_t CalcCRC(uint16_t* table, uint8_t* bytes, int32_t len, uint16_t initValue) {
                            	    18:     ;     uint16_t prevCRC = initValue;
                            	    19:     ;     for (int i = 0; i < len; i++) {
                            	    20:     ;         prevCRC = UpdateCRC(table, bytes[i], prevCRC);
                            	    21:     ;     }
                            	    22:     ;     return prevCRC;
                            	    23:     ; }
                            	    24: 
                            	    25: 
                            	    26:     ; whats this for - pushing the start to an address I can easily find in the mame debugger ..
00:00000000 60000402        	    27:     bra mhstart
00:00000004 0000102120423063	    28:     incbin "./target/crctable.bin"
00:0000000C 408450A560C670E7
00:00000014 81089129A14AB16B
00:0000001C C18CD1ADE1CEF1EF
00:00000024 1231021032732252
00:0000002C 52B5429472F762D6
00:00000034 93398318B37BA35A
00:0000003C D3BDC39CF3FFE3DE
00:00000044 2462344304201401
00:0000004C 64E674C744A45485
00:00000054 A56AB54B85289509
00:0000005C E5EEF5CFC5ACD58D
00:00000064 3653267216110630
00:0000006C 76D766F6569546B4
00:00000074 B75BA77A97198738
00:0000007C F7DFE7FED79DC7BC
00:00000084 48C458E5688678A7
00:0000008C 0840186128023823
00:00000094 C9CCD9EDE98EF9AF
00:0000009C 89489969A90AB92B
00:000000A4 5AF54AD47AB76A96
00:000000AC 1A710A503A332A12
00:000000B4 DBFDCBDCFBBFEB9E
00:000000BC 9B798B58BB3BAB1A
00:000000C4 6CA67C874CE45CC5
00:000000CC 2C223C030C601C41
00:000000D4 EDAEFD8FCDECDDCD
00:000000DC AD2ABD0B8D689D49
00:000000E4 7E976EB65ED54EF4
00:000000EC 3E132E321E510E70
00:000000F4 FF9FEFBEDFDDCFFC
00:000000FC BF1BAF3A9F598F78
00:00000104 918881A9B1CAA1EB
00:0000010C D10CC12DF14EE16F
00:00000114 108000A130C220E3
00:0000011C 5004402570466067
00:00000124 83B99398A3FBB3DA
00:0000012C C33DD31CE37FF35E
00:00000134 02B1129022F332D2
00:0000013C 4235521462777256
00:00000144 B5EAA5CB95A88589
00:0000014C F56EE54FD52CC50D
00:00000154 34E224C314A00481
00:0000015C 7466644754244405
00:00000164 A7DBB7FA879997B8
00:0000016C E75FF77EC71DD73C
00:00000174 26D336F2069116B0
00:0000017C 6657767646155634
00:00000184 D94CC96DF90EE92F
00:0000018C 99C889E9B98AA9AB
00:00000194 5844486578066827
00:0000019C 18C008E1388228A3
00:000001A4 CB7DDB5CEB3FFB1E
00:000001AC 8BF99BD8ABBBBB9A
00:000001B4 4A755A546A377A16
00:000001BC 0AF11AD02AB33A92
00:000001C4 FD2EED0FDD6CCD4D
00:000001CC BDAAAD8B9DE88DC9
00:000001D4 7C266C075C644C45
00:000001DC 3CA22C831CE00CC1
00:000001E4 EF1FFF3ECF5DDF7C
00:000001EC AF9BBFBA8FD99FF8
00:000001F4 6E177E364E555E74
00:000001FC 2E933EB20ED11EF0
00:00000204 0000102120423063	    29:     incbin "./target/crctable.bin"
00:0000020C 408450A560C670E7
00:00000214 81089129A14AB16B
00:0000021C C18CD1ADE1CEF1EF
00:00000224 1231021032732252
00:0000022C 52B5429472F762D6
00:00000234 93398318B37BA35A
00:0000023C D3BDC39CF3FFE3DE
00:00000244 2462344304201401
00:0000024C 64E674C744A45485
00:00000254 A56AB54B85289509
00:0000025C E5EEF5CFC5ACD58D
00:00000264 3653267216110630
00:0000026C 76D766F6569546B4
00:00000274 B75BA77A97198738
00:0000027C F7DFE7FED79DC7BC
00:00000284 48C458E5688678A7
00:0000028C 0840186128023823
00:00000294 C9CCD9EDE98EF9AF
00:0000029C 89489969A90AB92B
00:000002A4 5AF54AD47AB76A96
00:000002AC 1A710A503A332A12
00:000002B4 DBFDCBDCFBBFEB9E
00:000002BC 9B798B58BB3BAB1A
00:000002C4 6CA67C874CE45CC5
00:000002CC 2C223C030C601C41
00:000002D4 EDAEFD8FCDECDDCD
00:000002DC AD2ABD0B8D689D49
00:000002E4 7E976EB65ED54EF4
00:000002EC 3E132E321E510E70
00:000002F4 FF9FEFBEDFDDCFFC
00:000002FC BF1BAF3A9F598F78
00:00000304 918881A9B1CAA1EB
00:0000030C D10CC12DF14EE16F
00:00000314 108000A130C220E3
00:0000031C 5004402570466067
00:00000324 83B99398A3FBB3DA
00:0000032C C33DD31CE37FF35E
00:00000334 02B1129022F332D2
00:0000033C 4235521462777256
00:00000344 B5EAA5CB95A88589
00:0000034C F56EE54FD52CC50D
00:00000354 34E224C314A00481
00:0000035C 7466644754244405
00:00000364 A7DBB7FA879997B8
00:0000036C E75FF77EC71DD73C
00:00000374 26D336F2069116B0
00:0000037C 6657767646155634
00:00000384 D94CC96DF90EE92F
00:0000038C 99C889E9B98AA9AB
00:00000394 5844486578066827
00:0000039C 18C008E1388228A3
00:000003A4 CB7DDB5CEB3FFB1E
00:000003AC 8BF99BD8ABBBBB9A
00:000003B4 4A755A546A377A16
00:000003BC 0AF11AD02AB33A92
00:000003C4 FD2EED0FDD6CCD4D
00:000003CC BDAAAD8B9DE88DC9
00:000003D4 7C266C075C644C45
00:000003DC 3CA22C831CE00CC1
00:000003E4 EF1FFF3ECF5DDF7C
00:000003EC AF9BBFBA8FD99FF8
00:000003F4 6E177E364E555E74
00:000003FC 2E933EB20ED11EF0
                            	    30: 
                            	    31: mhstart:
00:00000404 7000            	    32:     moveq.l #0,D0                     ; set prevcrc to 0
00:00000406 323C01FF        	    33:     move.w  #(512-1),D1               ; loop counter
00:0000040A 41F900000200    	    34:     lea     testData,A0
00:00000410 43F900000000    	    35:     lea     tableCRC,A1
                            	    36: .loop:
00:00000416 7600            	    37:     moveq.l #0,D3
00:00000418 1600            	    38:     move.b  D0,D3                     ; D3 now has lo byte of prevcrc
00:0000041A E15B            	    39:     rol.w   #8,D3                     ; D3.W now has (prevcrc << 8)
00:0000041C 4200            	    40:     clr.b   D0
00:0000041E E158            	    41:     rol.w   #8,D0                     ; D0 now has prevcrc hi byte    
                            	    42: 
00:00000420 1818            	    43:     move.b  (A0)+,D4
00:00000422 B900            	    44:     eor.b   D4,D0                     ; eor with byte
                            	    45: 
00:00000424 E348            	    46:     lsl     D0                        ; allow for indexing by word
00:00000426 30310000        	    47:     move.w  0(A1,D0.w),D0             ; move value from tableCRC to D0
00:0000042A B740            	    48:     eor.w   D3,D0                     ; eor with prevcrc hi byte
00:0000042C 51C9FFE8        	    49:     dbra    D1,.loop
00:00000430 4E75            	    50:     rts                               ; answer should be in D0        
                            	    51: 
                            	    52:     section .data
                            	    53:     align 4
01:00000000 0000102120423063	    54: tableCRC:   incbin "./target/crctable.bin"
01:00000008 408450A560C670E7
01:00000010 81089129A14AB16B
01:00000018 C18CD1ADE1CEF1EF
01:00000020 1231021032732252
01:00000028 52B5429472F762D6
01:00000030 93398318B37BA35A
01:00000038 D3BDC39CF3FFE3DE
01:00000040 2462344304201401
01:00000048 64E674C744A45485
01:00000050 A56AB54B85289509
01:00000058 E5EEF5CFC5ACD58D
01:00000060 3653267216110630
01:00000068 76D766F6569546B4
01:00000070 B75BA77A97198738
01:00000078 F7DFE7FED79DC7BC
01:00000080 48C458E5688678A7
01:00000088 0840186128023823
01:00000090 C9CCD9EDE98EF9AF
01:00000098 89489969A90AB92B
01:000000A0 5AF54AD47AB76A96
01:000000A8 1A710A503A332A12
01:000000B0 DBFDCBDCFBBFEB9E
01:000000B8 9B798B58BB3BAB1A
01:000000C0 6CA67C874CE45CC5
01:000000C8 2C223C030C601C41
01:000000D0 EDAEFD8FCDECDDCD
01:000000D8 AD2ABD0B8D689D49
01:000000E0 7E976EB65ED54EF4
01:000000E8 3E132E321E510E70
01:000000F0 FF9FEFBEDFDDCFFC
01:000000F8 BF1BAF3A9F598F78
01:00000100 918881A9B1CAA1EB
01:00000108 D10CC12DF14EE16F
01:00000110 108000A130C220E3
01:00000118 5004402570466067
01:00000120 83B99398A3FBB3DA
01:00000128 C33DD31CE37FF35E
01:00000130 02B1129022F332D2
01:00000138 4235521462777256
01:00000140 B5EAA5CB95A88589
01:00000148 F56EE54FD52CC50D
01:00000150 34E224C314A00481
01:00000158 7466644754244405
01:00000160 A7DBB7FA879997B8
01:00000168 E75FF77EC71DD73C
01:00000170 26D336F2069116B0
01:00000178 6657767646155634
01:00000180 D94CC96DF90EE92F
01:00000188 99C889E9B98AA9AB
01:00000190 5844486578066827
01:00000198 18C008E1388228A3
01:000001A0 CB7DDB5CEB3FFB1E
01:000001A8 8BF99BD8ABBBBB9A
01:000001B0 4A755A546A377A16
01:000001B8 0AF11AD02AB33A92
01:000001C0 FD2EED0FDD6CCD4D
01:000001C8 BDAAAD8B9DE88DC9
01:000001D0 7C266C075C644C45
01:000001D8 3CA22C831CE00CC1
01:000001E0 EF1FFF3ECF5DDF7C
01:000001E8 AF9BBFBA8FD99FF8
01:000001F0 6E177E364E555E74
01:000001F8 2E933EB20ED11EF0
01:00000200 FF              	    55: testData:   blk.b 512,$FF             ; 512 bytes of 0xFF    
01:00000201 *
                            	    56: 


Symbols by name:
kmain                           00:00000000 EXP
mhstart                         00:00000404
tableCRC                        01:00000000
testData                        01:00000200

Symbols by value:
00000000 kmain
00000000 tableCRC
00000200 testData
00000404 mhstart
